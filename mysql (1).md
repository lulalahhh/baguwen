# 锁
## 表级锁
### 表锁
我们加**表锁**读锁,允许当前线程读，但阻止其他线程写操作。加写锁,运行当前线程读写,阻止其他线程对这个表进行,读写

### 元数据锁
<font style="color:rgb(44, 62, 80);">对一张表进行 CRUD 操作时，加的是元数据读锁,对一张表做结构变更操作的时候，加的是 MDL 写锁</font>

<font style="color:rgb(44, 62, 80);">主要就是防止进行执行sql语句,其他线程去更改表结构</font>

### <font style="color:rgb(44, 62, 80);">意向锁</font>
我们在对行加共享锁,会在加之前,会先加上共享意向锁,加排他锁之前,会先加上意向排他锁

<font style="color:rgb(44, 62, 80);">执行插入、更新、删除操作，需要先对表加上「意向独占锁」，然后对该记录加独占锁。</font>

<font style="color:rgb(44, 62, 80);">主要作用就是我们加</font><font style="color:rgb(44, 62, 80);">独占表锁还要遍历表里所有记录，查看是否有记录存在独占锁，这样效率会很慢。</font>

<font style="color:rgb(44, 62, 80);">有了意向锁,直接查该表是否有意向独占锁，如果有就意味着表里已经有记录被加了独占锁，这样就不用去遍历表里的记录。</font>

## 行级锁
**有记录锁,间隙锁,**

记录锁,有共享锁,排他锁,查询语句后面加lock in share mode 会加共享锁

for update还有更新删除语句会加排他锁

不同隔离级别下，行级锁的种类是不同的。

在读已提交隔离级别下，行级锁的种类只有记录锁，也就是仅仅把一条记录锁上。(**解决脏读,但是读取读的还是最新的数据,因为每次执行快照读都会生成读视图**)

**快照读加mvcc,当前读加间隙锁**

在可重复读隔离级别下，行级锁的种类除了有记录锁，还有间隙锁（**当前读**目的是为了避免幻读），所以行级锁的种类主要有三类：(**解决不可重复读,读取的是第一次读的数据,因为第一次执行快照读(查询数据)生成读视图后续复用**

如果用for update是最新数据**)**

• Record Lock，记录锁，也就是仅仅把一条记录锁上；

• Gap Lock，间隙锁，锁定一个范围，但是不包含记录本身；

• Next-Key Lock：Record Lock + Gap Lock 的组合，锁定一个范围，并且锁定记录本身。

![](https://cdn.nlark.com/yuque/0/2025/png/49451416/1748878903212-2976b90e-748f-45dd-afbe-6a1e4375d347.png)

**排他锁（FOR UPDATE） 或 共享锁（LOCK IN SHARE MODE） 都会触发间隙锁。**

排他锁虽然也能解决插入,但是只能针对当前行进行修改和插入,范围查询的时候,需要间隙锁,防止幻读

# 索引
### b＋树与b树


### 聚簇索引
### innodb与myisam


### 刷盘
# 
